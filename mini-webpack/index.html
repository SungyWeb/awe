<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.0.0"/><meta name="theme-color" content="#663399"/><style data-href="/awe/styles.eaff23864c29b765bb8a.css" data-identity="gatsby-global-css">:root{--border-radius:4px;--color-text:#333;--color-primary:#7026b9;--color-code-bg:#fff4db;--color-code:#8a6534;--font-sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";--font-mono:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--font-lg:18px;--font-md:16px;--font-sm:14px;--font-sx:12px;--line-height-loose:1.75;--line-height-normal:1.5;--line-height-dense:1.1;--space-1:4px;--space-2:8px;--space-3:16px;--space-4:24px;--space-5:32px;--space-6:64px;--size-content:54rem;--size-gutter:var(--space-5);--size-gap:var(--space-6)}html{box-sizing:border-box;font:sans-serif;font-size:var(--font-md);line-height:var(--line-height-normal);overflow-y:scroll}body{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;word-wrap:break-word;color:var(--color-text);font-family:sans-serif;font-family:var(--font-sans);font-weight:400}a{color:var(--color-primary);font-weight:500;text-decoration:underline;text-decoration-thickness:1.5px;text-underline-offset:2px}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}b,strong{font-weight:inherit}h1{letter-spacing:-.01em;line-height:var(--line-height-dense);margin:0 0 3rem;padding:0}h1>b{color:var(--color-primary)}img{max-width:100%}code,kbd,pre,samp{font-family:var(--font-mono);line-height:inherit}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin-bottom:calc(var(--space-4) - 1px);margin-left:0;margin-right:0;margin-top:0;padding:0}*,:after,:before{box-sizing:inherit}dd,dl,fieldset,figure,hgroup,img,ol,p,ul{margin:0;margin-bottom:var(--space-4);padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin-left:var(--space-4)}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:var(--border-radius);font-size:.875rem;line-height:var(--line-height-normal);margin-bottom:var(--space-4);margin-left:0;margin-right:0;padding:var(--space-4)}b,dt,strong,th{font-weight:700}li{margin-bottom:calc(var(--space-4)/2)}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:calc(var(--space-4)/2);margin-left:var(--space-4);margin-top:calc(var(--space-4)/2)}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:calc(var(--space-4)/2)}p{max-width:680px}code,kbd,samp{font-size:.875rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}code,tt{background-color:var(--color-code-bg);border-radius:var(--border-radius);color:var(--color-code);font-family:var(--font-mono);padding-bottom:.25em;padding-top:.25em;word-break:normal}pre code{background:none}code:after,code:before,tt:after,tt:before{content:"\00a0";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:none}.index-module--list--fb407{--w:280px;--n:2;display:grid;gap:var(--size-gap);grid-template-columns:repeat(auto-fit,minmax(max(var(--w),100%/(var(--n) + 1) + .1%),1fr));margin:0;margin-bottom:var(--size-gap);margin-top:var(--size-gap)}.index-module--listItem--06e6d{margin:0}.index-module--listItem--06e6d::marker{color:#e95800}.index-module--listItem--06e6d:nth-child(2)::marker{color:#159bf3}.index-module--listItem--06e6d:nth-child(3)::marker{color:#8eb814}.index-module--listItem--06e6d:nth-child(4)::marker{color:#639}.index-module--listItemLink--02c9e{color:var(--color-primary);font-weight:700}.index-module--listItemDescription--f3875{color:var(--color-text);margin-bottom:0;margin-top:var(--space-1)}.index-module--textCenter--4ece3{text-align:center}.index-module--intro--0b876{line-height:var(--line-height-loose);max-width:none}[class*=ant-] input::-ms-clear,[class*=ant-] input::-ms-reveal,[class*=ant-]::-ms-clear,[class^=ant-] input::-ms-clear,[class^=ant-] input::-ms-reveal,[class^=ant-]::-ms-clear{display:none}body,html{height:100%;width:100%}input::-ms-clear,input::-ms-reveal{display:none}*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:sans-serif;line-height:1.15}body{font-feature-settings:"tnum";background-color:#fff;color:rgba(0,0,0,.85);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:14px;font-variant:tabular-nums;line-height:1.5715;margin:0}[tabindex="-1"]:focus{outline:none!important}hr{box-sizing:content-box;height:0;overflow:visible}h1,h2,h3,h4,h5,h6{color:rgba(0,0,0,.85);font-weight:500;margin-bottom:.5em;margin-top:0}p{margin-bottom:1em;margin-top:0}abbr[data-original-title],abbr[title]{border-bottom:0;cursor:help;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}address{font-style:normal;line-height:inherit;margin-bottom:1em}input[type=number],input[type=password],input[type=text],textarea{-webkit-appearance:none}dl,ol,ul{margin-bottom:1em;margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:500}dd{margin-bottom:.5em;margin-left:0}blockquote{margin:0 0 1em}dfn{font-style:italic}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{-webkit-text-decoration-skip:objects;background-color:transparent;color:#1890ff;cursor:pointer;outline:none;text-decoration:none;transition:color .3s}a:hover{color:#40a9ff}a:active{color:#096dd9}a:active,a:focus,a:hover{outline:0;text-decoration:none}a[disabled]{color:rgba(0,0,0,.25);cursor:not-allowed}code,kbd,pre,samp{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1em}pre{margin-bottom:1em;margin-top:0;overflow:auto}figure{margin:0 0 1em}img{border-style:none;vertical-align:middle}[role=button],a,area,button,input:not([type=range]),label,select,summary,textarea{touch-action:manipulation}table{border-collapse:collapse}caption{caption-side:bottom;color:rgba(0,0,0,.45);padding-bottom:.3em;padding-top:.75em;text-align:left}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:inherit;line-height:inherit;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}textarea{overflow:auto;resize:vertical}fieldset{border:0;margin:0;min-width:0;padding:0}legend{color:inherit;display:block;font-size:1.5em;line-height:inherit;margin-bottom:.5em;max-width:100%;padding:0;white-space:normal;width:100%}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:none;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}output{display:inline-block}summary{display:list-item}template{display:none}[hidden]{display:none!important}mark{background-color:#feffe6;padding:.2em}::selection{background:#1890ff;color:#fff}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.anticon{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:inherit;display:inline-block;font-style:normal;line-height:0;text-align:center;text-rendering:optimizelegibility;text-transform:none;vertical-align:-.125em}.anticon>*{line-height:1}.anticon svg{display:inline-block}.anticon:before{display:none}.anticon .anticon-icon{display:block}.anticon>.anticon{line-height:0;vertical-align:0}.anticon[tabindex]{cursor:pointer}.anticon-spin,.anticon-spin:before{animation:loadingCircle 1s linear infinite;display:inline-block}.ant-fade-appear,.ant-fade-enter,.ant-fade-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-fade-appear.ant-fade-appear-active,.ant-fade-enter.ant-fade-enter-active{animation-name:antFadeIn;animation-play-state:running}.ant-fade-leave.ant-fade-leave-active{animation-name:antFadeOut;animation-play-state:running;pointer-events:none}.ant-fade-appear,.ant-fade-enter{animation-timing-function:linear;opacity:0}.ant-fade-leave{animation-timing-function:linear}@keyframes antFadeIn{0%{opacity:0}to{opacity:1}}@keyframes antFadeOut{0%{opacity:1}to{opacity:0}}.ant-move-up-appear,.ant-move-up-enter,.ant-move-up-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-move-up-appear.ant-move-up-appear-active,.ant-move-up-enter.ant-move-up-enter-active{animation-name:antMoveUpIn;animation-play-state:running}.ant-move-up-leave.ant-move-up-leave-active{animation-name:antMoveUpOut;animation-play-state:running;pointer-events:none}.ant-move-up-appear,.ant-move-up-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0}.ant-move-up-leave{animation-timing-function:cubic-bezier(.6,.04,.98,.34)}.ant-move-down-appear,.ant-move-down-enter,.ant-move-down-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-move-down-appear.ant-move-down-appear-active,.ant-move-down-enter.ant-move-down-enter-active{animation-name:antMoveDownIn;animation-play-state:running}.ant-move-down-leave.ant-move-down-leave-active{animation-name:antMoveDownOut;animation-play-state:running;pointer-events:none}.ant-move-down-appear,.ant-move-down-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0}.ant-move-down-leave{animation-timing-function:cubic-bezier(.6,.04,.98,.34)}.ant-move-left-appear,.ant-move-left-enter,.ant-move-left-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-move-left-appear.ant-move-left-appear-active,.ant-move-left-enter.ant-move-left-enter-active{animation-name:antMoveLeftIn;animation-play-state:running}.ant-move-left-leave.ant-move-left-leave-active{animation-name:antMoveLeftOut;animation-play-state:running;pointer-events:none}.ant-move-left-appear,.ant-move-left-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0}.ant-move-left-leave{animation-timing-function:cubic-bezier(.6,.04,.98,.34)}.ant-move-right-appear,.ant-move-right-enter,.ant-move-right-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-move-right-appear.ant-move-right-appear-active,.ant-move-right-enter.ant-move-right-enter-active{animation-name:antMoveRightIn;animation-play-state:running}.ant-move-right-leave.ant-move-right-leave-active{animation-name:antMoveRightOut;animation-play-state:running;pointer-events:none}.ant-move-right-appear,.ant-move-right-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0}.ant-move-right-leave{animation-timing-function:cubic-bezier(.6,.04,.98,.34)}@keyframes antMoveDownIn{0%{opacity:0;transform:translateY(100%);transform-origin:0 0}to{opacity:1;transform:translateY(0);transform-origin:0 0}}@keyframes antMoveDownOut{0%{opacity:1;transform:translateY(0);transform-origin:0 0}to{opacity:0;transform:translateY(100%);transform-origin:0 0}}@keyframes antMoveLeftIn{0%{opacity:0;transform:translateX(-100%);transform-origin:0 0}to{opacity:1;transform:translateX(0);transform-origin:0 0}}@keyframes antMoveLeftOut{0%{opacity:1;transform:translateX(0);transform-origin:0 0}to{opacity:0;transform:translateX(-100%);transform-origin:0 0}}@keyframes antMoveRightIn{0%{opacity:0;transform:translateX(100%);transform-origin:0 0}to{opacity:1;transform:translateX(0);transform-origin:0 0}}@keyframes antMoveRightOut{0%{opacity:1;transform:translateX(0);transform-origin:0 0}to{opacity:0;transform:translateX(100%);transform-origin:0 0}}@keyframes antMoveUpIn{0%{opacity:0;transform:translateY(-100%);transform-origin:0 0}to{opacity:1;transform:translateY(0);transform-origin:0 0}}@keyframes antMoveUpOut{0%{opacity:1;transform:translateY(0);transform-origin:0 0}to{opacity:0;transform:translateY(-100%);transform-origin:0 0}}@keyframes loadingCircle{to{transform:rotate(1turn)}}[ant-click-animating-without-extra-node=true],[ant-click-animating=true]{position:relative}html{--antd-wave-shadow-color:#1890ff;--scroll-bar:0}.ant-click-animating-node,[ant-click-animating-without-extra-node=true]:after{animation:fadeEffect 2s cubic-bezier(.08,.82,.17,1),waveEffect .4s cubic-bezier(.08,.82,.17,1);animation-fill-mode:forwards;border-radius:inherit;bottom:0;box-shadow:0 0 0 0 #1890ff;box-shadow:0 0 0 0 var(--antd-wave-shadow-color);content:"";display:block;left:0;opacity:.2;pointer-events:none;position:absolute;right:0;top:0}@keyframes waveEffect{to{box-shadow:0 0 0 #1890ff;box-shadow:0 0 0 6px var(--antd-wave-shadow-color)}}@keyframes fadeEffect{to{opacity:0}}.ant-slide-up-appear,.ant-slide-up-enter,.ant-slide-up-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-slide-up-appear.ant-slide-up-appear-active,.ant-slide-up-enter.ant-slide-up-enter-active{animation-name:antSlideUpIn;animation-play-state:running}.ant-slide-up-leave.ant-slide-up-leave-active{animation-name:antSlideUpOut;animation-play-state:running;pointer-events:none}.ant-slide-up-appear,.ant-slide-up-enter{animation-timing-function:cubic-bezier(.23,1,.32,1);opacity:0}.ant-slide-up-leave{animation-timing-function:cubic-bezier(.755,.05,.855,.06)}.ant-slide-down-appear,.ant-slide-down-enter,.ant-slide-down-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-slide-down-appear.ant-slide-down-appear-active,.ant-slide-down-enter.ant-slide-down-enter-active{animation-name:antSlideDownIn;animation-play-state:running}.ant-slide-down-leave.ant-slide-down-leave-active{animation-name:antSlideDownOut;animation-play-state:running;pointer-events:none}.ant-slide-down-appear,.ant-slide-down-enter{animation-timing-function:cubic-bezier(.23,1,.32,1);opacity:0}.ant-slide-down-leave{animation-timing-function:cubic-bezier(.755,.05,.855,.06)}.ant-slide-left-appear,.ant-slide-left-enter,.ant-slide-left-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-slide-left-appear.ant-slide-left-appear-active,.ant-slide-left-enter.ant-slide-left-enter-active{animation-name:antSlideLeftIn;animation-play-state:running}.ant-slide-left-leave.ant-slide-left-leave-active{animation-name:antSlideLeftOut;animation-play-state:running;pointer-events:none}.ant-slide-left-appear,.ant-slide-left-enter{animation-timing-function:cubic-bezier(.23,1,.32,1);opacity:0}.ant-slide-left-leave{animation-timing-function:cubic-bezier(.755,.05,.855,.06)}.ant-slide-right-appear,.ant-slide-right-enter,.ant-slide-right-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-slide-right-appear.ant-slide-right-appear-active,.ant-slide-right-enter.ant-slide-right-enter-active{animation-name:antSlideRightIn;animation-play-state:running}.ant-slide-right-leave.ant-slide-right-leave-active{animation-name:antSlideRightOut;animation-play-state:running;pointer-events:none}.ant-slide-right-appear,.ant-slide-right-enter{animation-timing-function:cubic-bezier(.23,1,.32,1);opacity:0}.ant-slide-right-leave{animation-timing-function:cubic-bezier(.755,.05,.855,.06)}@keyframes antSlideUpIn{0%{opacity:0;transform:scaleY(.8);transform-origin:0 0}to{opacity:1;transform:scaleY(1);transform-origin:0 0}}@keyframes antSlideUpOut{0%{opacity:1;transform:scaleY(1);transform-origin:0 0}to{opacity:0;transform:scaleY(.8);transform-origin:0 0}}@keyframes antSlideDownIn{0%{opacity:0;transform:scaleY(.8);transform-origin:100% 100%}to{opacity:1;transform:scaleY(1);transform-origin:100% 100%}}@keyframes antSlideDownOut{0%{opacity:1;transform:scaleY(1);transform-origin:100% 100%}to{opacity:0;transform:scaleY(.8);transform-origin:100% 100%}}@keyframes antSlideLeftIn{0%{opacity:0;transform:scaleX(.8);transform-origin:0 0}to{opacity:1;transform:scaleX(1);transform-origin:0 0}}@keyframes antSlideLeftOut{0%{opacity:1;transform:scaleX(1);transform-origin:0 0}to{opacity:0;transform:scaleX(.8);transform-origin:0 0}}@keyframes antSlideRightIn{0%{opacity:0;transform:scaleX(.8);transform-origin:100% 0}to{opacity:1;transform:scaleX(1);transform-origin:100% 0}}@keyframes antSlideRightOut{0%{opacity:1;transform:scaleX(1);transform-origin:100% 0}to{opacity:0;transform:scaleX(.8);transform-origin:100% 0}}.ant-zoom-appear,.ant-zoom-enter,.ant-zoom-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-appear.ant-zoom-appear-active,.ant-zoom-enter.ant-zoom-enter-active{animation-name:antZoomIn;animation-play-state:running}.ant-zoom-leave.ant-zoom-leave-active{animation-name:antZoomOut;animation-play-state:running;pointer-events:none}.ant-zoom-appear,.ant-zoom-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-appear-prepare,.ant-zoom-enter-prepare{transform:none}.ant-zoom-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}.ant-zoom-big-appear,.ant-zoom-big-enter,.ant-zoom-big-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-big-appear.ant-zoom-big-appear-active,.ant-zoom-big-enter.ant-zoom-big-enter-active{animation-name:antZoomBigIn;animation-play-state:running}.ant-zoom-big-leave.ant-zoom-big-leave-active{animation-name:antZoomBigOut;animation-play-state:running;pointer-events:none}.ant-zoom-big-appear,.ant-zoom-big-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-big-appear-prepare,.ant-zoom-big-enter-prepare{transform:none}.ant-zoom-big-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}.ant-zoom-big-fast-appear,.ant-zoom-big-fast-enter,.ant-zoom-big-fast-leave{animation-duration:.1s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-big-fast-appear.ant-zoom-big-fast-appear-active,.ant-zoom-big-fast-enter.ant-zoom-big-fast-enter-active{animation-name:antZoomBigIn;animation-play-state:running}.ant-zoom-big-fast-leave.ant-zoom-big-fast-leave-active{animation-name:antZoomBigOut;animation-play-state:running;pointer-events:none}.ant-zoom-big-fast-appear,.ant-zoom-big-fast-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-big-fast-appear-prepare,.ant-zoom-big-fast-enter-prepare{transform:none}.ant-zoom-big-fast-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}.ant-zoom-up-appear,.ant-zoom-up-enter,.ant-zoom-up-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-up-appear.ant-zoom-up-appear-active,.ant-zoom-up-enter.ant-zoom-up-enter-active{animation-name:antZoomUpIn;animation-play-state:running}.ant-zoom-up-leave.ant-zoom-up-leave-active{animation-name:antZoomUpOut;animation-play-state:running;pointer-events:none}.ant-zoom-up-appear,.ant-zoom-up-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-up-appear-prepare,.ant-zoom-up-enter-prepare{transform:none}.ant-zoom-up-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}.ant-zoom-down-appear,.ant-zoom-down-enter,.ant-zoom-down-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-down-appear.ant-zoom-down-appear-active,.ant-zoom-down-enter.ant-zoom-down-enter-active{animation-name:antZoomDownIn;animation-play-state:running}.ant-zoom-down-leave.ant-zoom-down-leave-active{animation-name:antZoomDownOut;animation-play-state:running;pointer-events:none}.ant-zoom-down-appear,.ant-zoom-down-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-down-appear-prepare,.ant-zoom-down-enter-prepare{transform:none}.ant-zoom-down-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}.ant-zoom-left-appear,.ant-zoom-left-enter,.ant-zoom-left-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-left-appear.ant-zoom-left-appear-active,.ant-zoom-left-enter.ant-zoom-left-enter-active{animation-name:antZoomLeftIn;animation-play-state:running}.ant-zoom-left-leave.ant-zoom-left-leave-active{animation-name:antZoomLeftOut;animation-play-state:running;pointer-events:none}.ant-zoom-left-appear,.ant-zoom-left-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-left-appear-prepare,.ant-zoom-left-enter-prepare{transform:none}.ant-zoom-left-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}.ant-zoom-right-appear,.ant-zoom-right-enter,.ant-zoom-right-leave{animation-duration:.2s;animation-fill-mode:both;animation-play-state:paused}.ant-zoom-right-appear.ant-zoom-right-appear-active,.ant-zoom-right-enter.ant-zoom-right-enter-active{animation-name:antZoomRightIn;animation-play-state:running}.ant-zoom-right-leave.ant-zoom-right-leave-active{animation-name:antZoomRightOut;animation-play-state:running;pointer-events:none}.ant-zoom-right-appear,.ant-zoom-right-enter{animation-timing-function:cubic-bezier(.08,.82,.17,1);opacity:0;transform:scale(0)}.ant-zoom-right-appear-prepare,.ant-zoom-right-enter-prepare{transform:none}.ant-zoom-right-leave{animation-timing-function:cubic-bezier(.78,.14,.15,.86)}@keyframes antZoomIn{0%{opacity:0;transform:scale(.2)}to{opacity:1;transform:scale(1)}}@keyframes antZoomOut{0%{transform:scale(1)}to{opacity:0;transform:scale(.2)}}@keyframes antZoomBigIn{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes antZoomBigOut{0%{transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes antZoomUpIn{0%{opacity:0;transform:scale(.8);transform-origin:50% 0}to{transform:scale(1);transform-origin:50% 0}}@keyframes antZoomUpOut{0%{transform:scale(1);transform-origin:50% 0}to{opacity:0;transform:scale(.8);transform-origin:50% 0}}@keyframes antZoomLeftIn{0%{opacity:0;transform:scale(.8);transform-origin:0 50%}to{transform:scale(1);transform-origin:0 50%}}@keyframes antZoomLeftOut{0%{transform:scale(1);transform-origin:0 50%}to{opacity:0;transform:scale(.8);transform-origin:0 50%}}@keyframes antZoomRightIn{0%{opacity:0;transform:scale(.8);transform-origin:100% 50%}to{transform:scale(1);transform-origin:100% 50%}}@keyframes antZoomRightOut{0%{transform:scale(1);transform-origin:100% 50%}to{opacity:0;transform:scale(.8);transform-origin:100% 50%}}@keyframes antZoomDownIn{0%{opacity:0;transform:scale(.8);transform-origin:50% 100%}to{transform:scale(1);transform-origin:50% 100%}}@keyframes antZoomDownOut{0%{transform:scale(1);transform-origin:50% 100%}to{opacity:0;transform:scale(.8);transform-origin:50% 100%}}.ant-motion-collapse-legacy{overflow:hidden}.ant-motion-collapse,.ant-motion-collapse-legacy-active{transition:height .2s cubic-bezier(.645,.045,.355,1),opacity .2s cubic-bezier(.645,.045,.355,1)!important}.ant-motion-collapse{overflow:hidden}.ant-anchor{font-feature-settings:"tnum";box-sizing:border-box;color:rgba(0,0,0,.85);font-size:14px;font-variant:tabular-nums;line-height:1.5715;list-style:none;margin:0;padding:0 0 0 2px;position:relative}.ant-anchor-wrapper{background-color:transparent;margin-left:-4px;overflow:auto;padding-left:4px}.ant-anchor-ink{height:100%;left:0;position:absolute;top:0}.ant-anchor-ink:before{background-color:#f0f0f0;content:" ";display:block;height:100%;margin:0 auto;position:relative;width:2px}.ant-anchor-ink-ball{background-color:#fff;border:2px solid #1890ff;border-radius:8px;display:none;height:8px;left:50%;position:absolute;transform:translateX(-50%);transition:top .3s ease-in-out;width:8px}.ant-anchor-ink-ball.ant-anchor-ink-ball-visible{display:inline-block}.ant-anchor-fixed .ant-anchor-ink .ant-anchor-ink-ball{display:none}.ant-anchor-link{padding:4px 0 4px 16px}.ant-anchor-link-title{color:rgba(0,0,0,.85);display:block;margin-bottom:3px;overflow:hidden;position:relative;text-overflow:ellipsis;transition:all .3s;white-space:nowrap}.ant-anchor-link-title:only-child{margin-bottom:0}.ant-anchor-link-active>.ant-anchor-link-title{color:#1890ff}.ant-anchor-link .ant-anchor-link{padding-bottom:2px;padding-top:2px}.ant-anchor-rtl{direction:rtl}.ant-anchor-rtl.ant-anchor-wrapper{margin-left:0;margin-right:-4px;padding-left:0;padding-right:4px}.ant-anchor-rtl .ant-anchor-ink{left:auto;right:0}.ant-anchor-rtl .ant-anchor-ink-ball{left:0;right:50%;transform:translateX(50%)}.ant-anchor-rtl .ant-anchor-link{padding:4px 16px 4px 0}.ant-affix{position:fixed;z-index:10}.blog-templete blockquote{background-color:azure;padding:1em 2em;word-break:break-all}</style><link rel="icon" href="/awe/favicon-32x32.png?v=b35bb12e5b3c28c136e7daccb9c0dea3" type="image/png"/><link rel="icon" href="/awe/favicon.svg?v=b35bb12e5b3c28c136e7daccb9c0dea3" type="image/svg+xml"/><link rel="manifest" href="/awe/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/awe/icons/icon-48x48.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="72x72" href="/awe/icons/icon-72x72.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="96x96" href="/awe/icons/icon-96x96.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="144x144" href="/awe/icons/icon-144x144.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="192x192" href="/awe/icons/icon-192x192.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="256x256" href="/awe/icons/icon-256x256.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="384x384" href="/awe/icons/icon-384x384.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/><link rel="apple-touch-icon" sizes="512x512" href="/awe/icons/icon-512x512.png?v=b35bb12e5b3c28c136e7daccb9c0dea3"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header style="margin:0 auto;padding:var(--space-4) var(--size-gutter);display:flex;align-items:center;justify-content:space-between"><a style="font-size:var(--font-sm);text-decoration:none" href="/awe/">blog by sungy</a><img alt="Gatsby logo" height="20" style="margin:0" src="data:image/svg+xml,%3Csvg fill=&#x27;none&#x27; viewBox=&#x27;0 0 107 28&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; xmlns:xlink=&#x27;http://www.w3.org/1999/xlink&#x27;%3E%3CclipPath id=&#x27;a&#x27;%3E%3Cpath d=&#x27;m0 0h106.1v28h-106.1z&#x27;/%3E%3C/clipPath%3E%3Cg clip-path=&#x27;url(%23a)&#x27;%3E%3Cg fill=&#x27;%23000&#x27;%3E%3Cpath clip-rule=&#x27;evenodd&#x27; d=&#x27;m89 11.7c-.8 0-2.2.2-3.2 1.6v-8.10005h-2.8v16.80005h2.7v-1.3c1.1 1.5 2.6 1.5999 3.2 1.5999 3 0 5-2.2999 5-5.2999s-2-5.3-4.9-5.3zm-.7 2.5c1.7 0 2.8 1.2 2.8 2.8s-1.2 2.8-2.8 2.8c-1.7 0-2.8-1.2-2.8-2.8s1.1-2.8 2.8-2.8z&#x27; fill-rule=&#x27;evenodd&#x27;/%3E%3Cpath d=&#x27;m71.2 21.9999v-7.6h1.9v-2.4h-1.9v-3.40005h-2.8v3.40005h-1.1v2.4h1.1v7.6z&#x27;/%3E%3Cpath clip-rule=&#x27;evenodd&#x27; d=&#x27;m65.6999 12h-2.9v1.3c-.8999-1.5-2.4-1.6-3.2-1.6-2.9 0-4.8999 2.4-4.8999 5.3s1.9999 5.2999 5.0999 5.2999c.8 0 2.1001-.0999 3.1001-1.5999v1.3h2.7999zm-5.1999 7.8c-1.7001 0-2.8-1.2-2.8-2.8s1.2-2.8 2.8-2.8c1.7 0 2.7999 1.2 2.7999 2.8s-1.1999 2.8-2.7999 2.8z&#x27; fill-rule=&#x27;evenodd&#x27;/%3E%3Cpath d=&#x27;m79.7001 14.4c-.7-.6-1.3-.7-1.6-.7-.7 0-1.1.3-1.1.8 0 .3.1.6.9.9l.7.2c.1261.0472.2621.0945.4037.1437.7571.2632 1.6751.5823 2.0963 1.2563.3.4.5 1 .5 1.7 0 .9-.3 1.8-1.1 2.5s-1.8 1.0999-3 1.0999c-2.1 0-3.2-.9999-3.9-1.6999l1.5-1.7c.6.6 1.4 1.2 2.2 1.2s1.4-.4 1.4-1.1c0-.6-.5-.9-.9-1l-.6-.2c-.0687-.0295-.1384-.0589-.2087-.0887l-.0011-.0004c-.6458-.2729-1.3496-.5704-1.8902-1.1109-.5-.5-.8-1.1-.8-1.9 0-1 .5-1.8 1-2.3.8-.6 1.8-.7 2.6-.7.7 0 1.9.1 3.2 1.1z&#x27;/%3E%3Cpath d=&#x27;m98.5 20.5-4.8-8.5h3.3l3.1 5.7 2.8-5.7h3.2l-8 15.3h-3.2z&#x27;/%3E%3Cpath d=&#x27;m47 13.7h7c0 .0634.01.1267.0206.1932.0227.1435.0477.3018-.0206.5068 0 4.5-3.4 8.1-8 8.1s-8-3.6-8-8.1c0-4.49995 3.6-8.09995 8-8.09995 2.6 0 5 1.2 6.5 3.3l-2.3 1.49995c-1-1.29995-2.6-2.09995-4.2-2.09995-2.9 0-4.9 2.49995-4.9 5.39995s2.1 5.3 5 5.3c2.6 0 4-1.3 4.6-3.2h-3.7z&#x27;/%3E%3C/g%3E%3Cpath d=&#x27;m18 14h7c0 5.2-3.7 9.6-8.5 10.8l-13.19995-13.2c1.1-4.9 5.5-8.6 10.69995-8.6 3.7 0 6.9 1.8 8.9 4.5l-1.5 1.3c-1.7-2.3-4.4-3.8-7.4-3.8-3.9 0-7.29995 2.5-8.49995 6l11.49995 11.5c2.9-1 5.1-3.5 5.8-6.5h-4.8z&#x27; fill=&#x27;%23fff&#x27;/%3E%3Cpath d=&#x27;m6.2 21.7001c-2.1-2.1-3.2-4.8-3.2-7.6l10.8 10.8c-2.7 0-5.5-1.1-7.6-3.2z&#x27; fill=&#x27;%23fff&#x27;/%3E%3Cpath d=&#x27;m14 0c-7.7 0-14 6.3-14 14s6.3 14 14 14 14-6.3 14-14-6.3-14-14-14zm-7.8 21.8c-2.1-2.1-3.2-4.9-3.2-7.6l10.9 10.8c-2.8-.1-5.6-1.1-7.7-3.2zm10.2 2.9-13.1-13.1c1.1-4.9 5.5-8.6 10.7-8.6 3.7 0 6.9 1.8 8.9 4.5l-1.5 1.3c-1.7-2.3-4.4-3.8-7.4-3.8-3.9 0-7.2 2.5-8.5 6l11.5 11.5c2.9-1 5.1-3.5 5.8-6.5h-4.8v-2h7c0 5.2-3.7 9.6-8.6 10.7z&#x27; fill=&#x27;%237026b9&#x27;/%3E%3C/g%3E%3C/svg%3E"/></header><div style="margin:0 auto;max-width:var(--size-content);padding:var(--size-gutter)"><main><div class="blog-templete"><h1>从零实现一个迷你 Webpack</h1>
<p>Webpack 是当前使用较多的一个打包工具，下面以打包为目的，实现一个简易版的 webpack，支持单入口文件的打包，不涉及插件、分包等。</p>
<h1>前置知识</h1>
<p>以 webpack 5.x 为例，先来简单看个 demo，可以看到 webpac 的输入、输出的代码是什么样的。</p>
<p>源码</p>
<pre class="grvsc-container dark-default-dark" data-language="js" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// index.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;./a.js&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">&quot;入口文件&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// a.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;./b.js&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">&quot;a.js 文件&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// b.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">&quot;b.js 文件&quot;</span><span class="mtk1">)</span></span></span></code></pre>
<p>打包后</p>
<pre class="grvsc-container dark-default-dark" data-language="js" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">;(() </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">var</span><span class="mtk1"> </span><span class="mtk12">__webpack_modules__</span><span class="mtk1"> = {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;./a.js&quot;</span><span class="mtk12">:</span><span class="mtk1"> (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">__unused_webpack_module</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">__unused_webpack_exports</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">__webpack_require__</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ) </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">__webpack_require__</span><span class="mtk1">(</span><span class="mtk3">/*! ./b.js */</span><span class="mtk1"> </span><span class="mtk8">&quot;./b.js&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">&quot;a.js 文件&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;./b.js&quot;</span><span class="mtk12">:</span><span class="mtk1"> () </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">&quot;b.js 文件&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// The module cache</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">var</span><span class="mtk1"> </span><span class="mtk12">__webpack_module_cache__</span><span class="mtk1"> = {}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// The require function</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">__webpack_require__</span><span class="mtk1">(</span><span class="mtk12">moduleId</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Check if module is in cache</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">var</span><span class="mtk1"> </span><span class="mtk12">cachedModule</span><span class="mtk1"> = </span><span class="mtk12">__webpack_module_cache__</span><span class="mtk1">[</span><span class="mtk12">moduleId</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">cachedModule</span><span class="mtk1"> !== </span><span class="mtk4">undefined</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">cachedModule</span><span class="mtk1">.</span><span class="mtk12">exports</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Create a new module (and put it into the cache)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">var</span><span class="mtk1"> </span><span class="mtk12">module</span><span class="mtk1"> = (</span><span class="mtk12">__webpack_module_cache__</span><span class="mtk1">[</span><span class="mtk12">moduleId</span><span class="mtk1">] = {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// no module.id needed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// no module.loaded needed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">exports:</span><span class="mtk1"> {},</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Execute the module function</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">__webpack_modules__</span><span class="mtk1">[</span><span class="mtk12">moduleId</span><span class="mtk1">](</span><span class="mtk10">module</span><span class="mtk1">, </span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk10">exports</span><span class="mtk1">, </span><span class="mtk12">__webpack_require__</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Return the exports of the module</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk10">exports</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">var</span><span class="mtk1"> </span><span class="mtk12">__webpack_exports__</span><span class="mtk1"> = {}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  ;(() </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">__webpack_require__</span><span class="mtk1">(</span><span class="mtk3">/*! ./a.js */</span><span class="mtk1"> </span><span class="mtk8">&quot;./a.js&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">&quot;入口文件&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  })()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})()</span></span></span></code></pre>
<p>可以看到打包产物是一个立即执行函数，将除了入口文件的代码以文件名为 key，以文件内代码为 value，保存到名为<code>__webpack_modules__</code>的对象中；接着实现了一个<code>__webpack_require__</code>方法，并将代码中的<code>require</code>替换成该函数；最后执行入口文件代码。</p>
<p>通过入口文件，将直接依赖或间接依赖以 module 的形式组织到一起，并通过自行实现的<code>require</code>实现模块的同步加载。</p>
<h1>初始化参数</h1>
<p>webpack 函数接收一些配置项，并返回一个<a href="https://www.webpackjs.com/api/node/#compiler-instance">compiler 对象</a>，compiler 对象包含<code>run</code>方法来执行编译，即大致流程如下</p>
<pre class="grvsc-container dark-default-dark" data-language="js" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">webpack</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;webpack&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">compiler</span><span class="mtk1"> = </span><span class="mtk11">webpack</span><span class="mtk1">(</span><span class="mtk12">options</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">compiler</span><span class="mtk1">.</span><span class="mtk11">run</span><span class="mtk1">(</span><span class="mtk12">err</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {})</span></span></span></code></pre>
<p>先来实现 webpack 方法</p>
<pre class="grvsc-container dark-default-dark" data-language="js" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">webpack</span><span class="mtk1">(</span><span class="mtk12">options</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">compiler</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">Compiler</span><span class="mtk1">(</span><span class="mtk12">options</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">compiler</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk10">exports</span><span class="mtk1"> = </span><span class="mtk12">webpack</span></span></span></code></pre>
<p>接下来实现<code>Compiler</code>类，首先要明确编译过程需要做的事情</p>
<ol>
<li>读取入口文件，将入口文件交给匹配的 loader 处理，返回处理后的代码</li>
<li>开始编译 loader 处理完的代码</li>
<li>如果代码中依赖了其他文件，则对 require 函数替换为<code>__webpack_require__</code>，保存该文件的处理结果，同时让其他文件回到第 1 步进行处理，不断循环</li>
<li>编译结束后，每个文件都有对应的处理结果，将这些文件的文件结果从最初的的入口文件开始，组织到一起</li>
</ol>
<p>语法树 AST 相关的生成、遍历、转换等操作需要借助<code>babel</code></p>
<p><svg viewBox="-8 -8 2128.390625 246.703125" style="max-width: 2128.390625px;" aria-labelledby="chart-title-remark-mermaid-0 chart-desc-remark-mermaid-0" role="img" xmlns="http://www.w3.org/2000/svg" width="100%" id="remark-mermaid-0"><desc id="chart-desc-remark-mermaid-0"></desc><style>#remark-mermaid-0 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#remark-mermaid-0 .error-icon{fill:#552222;}#remark-mermaid-0 .error-text{fill:#552222;stroke:#552222;}#remark-mermaid-0 .edge-thickness-normal{stroke-width:2px;}#remark-mermaid-0 .edge-thickness-thick{stroke-width:3.5px;}#remark-mermaid-0 .edge-pattern-solid{stroke-dasharray:0;}#remark-mermaid-0 .edge-pattern-dashed{stroke-dasharray:3;}#remark-mermaid-0 .edge-pattern-dotted{stroke-dasharray:2;}#remark-mermaid-0 .marker{fill:#666;stroke:#666;}#remark-mermaid-0 .marker.cross{stroke:#666;}#remark-mermaid-0 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#remark-mermaid-0 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#remark-mermaid-0 .cluster-label text{fill:#333;}#remark-mermaid-0 .cluster-label span{color:#333;}#remark-mermaid-0 .label text,#remark-mermaid-0 span{fill:#000000;color:#000000;}#remark-mermaid-0 .node rect,#remark-mermaid-0 .node circle,#remark-mermaid-0 .node ellipse,#remark-mermaid-0 .node polygon,#remark-mermaid-0 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#remark-mermaid-0 .node .label{text-align:center;}#remark-mermaid-0 .node.clickable{cursor:pointer;}#remark-mermaid-0 .arrowheadPath{fill:#333333;}#remark-mermaid-0 .edgePath .path{stroke:#666;stroke-width:2.0px;}#remark-mermaid-0 .flowchart-link{stroke:#666;fill:none;}#remark-mermaid-0 .edgeLabel{background-color:white;text-align:center;}#remark-mermaid-0 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#remark-mermaid-0 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#remark-mermaid-0 .cluster text{fill:#333;}#remark-mermaid-0 .cluster span{color:#333;}#remark-mermaid-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#remark-mermaid-0 .node rect{fill:#fff;}#remark-mermaid-0 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="10" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="0" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g id="compiler" class="cluster default"><rect height="230.703125" width="1683.828125" y="0" x="428.5625" ry="0" rx="0" style=""></rect><g transform="translate(1239.0078125, 5)" class="cluster-label"><foreignObject height="19" width="62.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">compiler</span></div></foreignObject></g></g><g id="js文件" class="cluster default"><rect height="176.6015625" width="417.53125" y="34.1015625" x="1285" ry="0" rx="0" style=""></rect><g transform="translate(1471.59375, 39.1015625)" class="cluster-label"><foreignObject height="21" width="44.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">js文件</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M58.765625,130.65234375L62.932291666666664,130.65234375C67.09895833333333,130.65234375,75.43229166666667,130.65234375,83.765625,130.65234375C92.09895833333333,130.65234375,100.43229166666667,130.65234375,104.59895833333333,130.65234375L108.765625,130.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M218.625,130.65234375L222.79166666666666,130.65234375C226.95833333333334,130.65234375,235.29166666666666,130.65234375,243.625,130.65234375C251.95833333333334,130.65234375,260.2916666666667,130.65234375,264.4583333333333,130.65234375L268.625,130.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M378.5625,130.65234375L382.7291666666667,130.65234375C386.8958333333333,130.65234375,395.2291666666667,130.65234375,403.5625,130.65234375C411.8958333333333,130.65234375,420.2291666666667,130.65234375,428.5625,130.65234375C436.8958333333333,130.65234375,445.2291666666667,130.65234375,449.3958333333333,130.65234375L453.5625,130.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M577.65625,130.65234375L589.1197916666666,130.65234375C600.5833333333334,130.65234375,623.5104166666666,130.65234375,646.4375,130.65234375C669.3645833333334,130.65234375,692.2916666666666,130.65234375,703.7552083333334,130.65234375L715.21875,130.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" id="L-E-F-0" d="M781.3772843977039,112.65234375L787.68419533142,108.39388020833333C793.991106265136,104.13541666666667,806.604928132568,95.61848958333333,817.0785057329507,91.36002604166667C827.5520833333334,87.1015625,835.8854166666666,87.1015625,840.0520833333334,87.1015625L844.21875,87.1015625"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-JSFILE" id="L-F-JSFILE-0" d="M984.796875,87.1015625L988.9635416666666,87.1015625C993.1302083333334,87.1015625,1001.4635416666666,87.1015625,1009.8802083333334,87.18489583333333C1018.296875,87.26822916666667,1026.796875,87.43489583333333,1031.046875,87.51822916666667L1035.296875,87.6015625"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-JSFILE LE-G" id="L-JSFILE-G-0" d="M1139.5,87.6015625L1151.5833333333333,87.51822916666667C1163.6666666666667,87.43489583333333,1187.8333333333333,87.26822916666667,1212.0833333333333,87.18489583333333C1236.3333333333333,87.1015625,1260.6666666666667,87.1015625,1277,87.1015625C1293.3333333333333,87.1015625,1301.6666666666667,87.1015625,1305.8333333333333,87.1015625L1310,87.1015625"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M1351.421875,87.1015625L1355.5885416666667,87.1015625C1359.7552083333333,87.1015625,1368.0885416666667,87.1015625,1376.421875,87.1015625C1384.7552083333333,87.1015625,1393.0885416666667,87.1015625,1397.2552083333333,87.1015625L1401.421875,87.1015625"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-J" id="L-H-J-0" d="M1548.53125,87.1015625L1552.6979166666667,87.1015625C1556.8645833333333,87.1015625,1565.1979166666667,87.1015625,1575.6714942670494,91.36002604166667C1586.145071867432,95.61848958333333,1598.758893734864,104.13541666666667,1605.0658046685803,108.39388020833333L1611.3727156022962,112.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-I" id="L-J-I-0" d="M1677.53125,130.65234375L1681.6979166666667,130.65234375C1685.8645833333333,130.65234375,1694.1979166666667,130.65234375,1702.53125,130.65234375C1710.8645833333333,130.65234375,1719.1979166666667,130.65234375,1727.53125,130.65234375C1735.8645833333333,130.65234375,1744.1979166666667,130.65234375,1748.3645833333333,130.65234375L1752.53125,130.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-E" id="L-J-E-0" d="M1611.3727156022962,148.65234375L1605.0658046685803,152.91080729166666C1598.758893734864,157.16927083333334,1586.145071867432,165.68619791666666,1563.412379683716,169.94466145833334C1540.6796875,174.203125,1507.828125,174.203125,1474.9765625,174.203125C1442.125,174.203125,1409.2734375,174.203125,1385.2291666666667,174.203125C1361.1848958333333,174.203125,1345.9479166666667,174.203125,1330.7109375,174.203125C1315.4739583333333,174.203125,1300.2369791666667,174.203125,1280.4518229166667,174.203125C1260.6666666666667,174.203125,1236.3333333333333,174.203125,1203.31640625,174.203125C1170.2994791666667,174.203125,1128.5989583333333,174.203125,1094.8984375,174.203125C1061.1979166666667,174.203125,1035.4973958333333,174.203125,1006.765625,174.203125C978.0338541666666,174.203125,946.2708333333334,174.203125,914.5078125,174.203125C882.7447916666666,174.203125,850.9817708333334,174.203125,828.7933494829507,169.94466145833334C806.604928132568,165.68619791666666,793.991106265136,157.16927083333334,787.6841953314198,152.91080729166666L781.3772843977039,148.65234375"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-K" id="L-I-K-0" d="M1831.53125,130.65234375L1846.26953125,130.65234375C1861.0078125,130.65234375,1890.484375,130.65234375,1919.9609375,130.65234375C1949.4375,130.65234375,1978.9140625,130.65234375,1993.65234375,130.65234375L2008.390625,130.65234375"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(646.4375, 130.65234375)" class="edgeLabel"><g transform="translate(-43.78125, -9.5)" class="label"><foreignObject height="19" width="87.5625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">config.entry</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(1212, 87.1015625)" class="edgeLabel"><g transform="translate(-8, -10.5)" class="label"><foreignObject height="21" width="16"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">是</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(1212, 174.203125)" class="edgeLabel"><g transform="translate(-48, -10.5)" class="label"><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">依赖文件路径</span></div></foreignObject></g></g><g transform="translate(1919.9609375, 130.65234375)" class="edgeLabel"><g transform="translate(-63.4296875, -10.5)" class="label"><foreignObject height="21" width="126.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">混入webpack模板</span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(515.609375, 130.65234375)" id="flowchart-D-59" class="node default default"><rect height="36" width="124.09375" y="-18" x="-62.046875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-54.546875, -10.5)" style="" class="label"><foreignObject height="21" width="109.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">执行copiler.run</span></div></foreignObject></g></g><g transform="translate(754.71875, 130.65234375)" id="flowchart-E-60" class="node default default"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-32, -10.5)" style="" class="label"><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">读取文件</span></div></foreignObject></g></g><g transform="translate(914.5078125, 87.1015625)" id="flowchart-F-61" class="node default default"><rect height="36" width="140.578125" y="-18" x="-70.2890625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-62.7890625, -10.5)" style="" class="label"><foreignObject height="21" width="125.578125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">对应的loader处理</span></div></foreignObject></g></g><g transform="translate(1086.8984375, 87.1015625)" id="flowchart-JSFILE-62" class="node default default"><polygon style="" transform="translate(-52.1015625,52.1015625)" class="label-container" points="52.1015625,0 104.203125,-52.1015625 52.1015625,-104.203125 0,-52.1015625"></polygon><g transform="translate(-26.6015625, -10.5)" style="" class="label"><foreignObject height="21" width="53.203125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">JS文件?</span></div></foreignObject></g></g><g transform="translate(1792.03125, 130.65234375)" id="flowchart-I-66" class="node default default"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-32, -10.5)" style="" class="label"><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">生成代码</span></div></foreignObject></g></g><g transform="translate(2047.890625, 130.65234375)" id="flowchart-K-67" class="node default default"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-32, -10.5)" style="" class="label"><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">写入文件</span></div></foreignObject></g></g><g transform="translate(1330.7109375, 87.1015625)" id="flowchart-G-63" class="node default default"><rect height="34" width="41.421875" y="-17" x="-20.7109375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-13.2109375, -9.5)" style="" class="label"><foreignObject height="19" width="26.421875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">AST</span></div></foreignObject></g></g><g transform="translate(1474.9765625, 87.1015625)" id="flowchart-H-64" class="node default default"><rect height="36" width="147.109375" y="-18" x="-73.5546875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-66.0546875, -10.5)" style="" class="label"><foreignObject height="21" width="132.109375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">替换关键字require</span></div></foreignObject></g></g><g transform="translate(1638.03125, 130.65234375)" id="flowchart-J-65" class="node default default"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-32, -10.5)" style="" class="label"><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">遍历依赖</span></div></foreignObject></g></g><g transform="translate(29.3828125, 130.65234375)" id="flowchart-A-56" class="node default default"><rect height="34" width="58.765625" y="-17" x="-29.3828125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-21.8828125, -9.5)" style="" class="label"><foreignObject height="19" width="43.765625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">config</span></div></foreignObject></g></g><g transform="translate(163.6953125, 130.65234375)" id="flowchart-B-57" class="node default default"><rect height="36" width="109.859375" y="-18" x="-54.9296875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-47.4296875, -10.5)" style="" class="label"><foreignObject height="21" width="94.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">webpack函数</span></div></foreignObject></g></g><g transform="translate(323.59375, 130.65234375)" id="flowchart-C-58" class="node default default"><rect height="36" width="109.9375" y="-18" x="-54.96875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-47.46875, -10.5)" style="" class="label"><foreignObject height="21" width="94.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">返回compiler</span></div></foreignObject></g></g></g></g></g></svg></p>
<pre class="grvsc-container dark-default-dark" data-language="js" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">fs</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;fs&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">path</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;path&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">parser</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;@babel/parser&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">traverser</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;@babel/traverse&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">t</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;@babel/types&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">generate</span><span class="mtk1"> = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">&quot;babel-generator&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">class</span><span class="mtk1"> </span><span class="mtk10">Compiler</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">constructor</span><span class="mtk1">(</span><span class="mtk12">options</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1"> = </span><span class="mtk12">options</span><span class="mtk1"> || {}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 保存编译过的module</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">modules</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">Set</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">run</span><span class="mtk1">(</span><span class="mtk12">callback</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">entryModule</span><span class="mtk1"> = </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">build</span><span class="mtk1">(</span><span class="mtk12">path</span><span class="mtk1">.</span><span class="mtk11">join</span><span class="mtk1">(</span><span class="mtk12">process</span><span class="mtk1">.</span><span class="mtk11">cwd</span><span class="mtk1">(), </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">entry</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">entryChunk</span><span class="mtk1"> = </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">buildChunk</span><span class="mtk1">(</span><span class="mtk8">&quot;entry&quot;</span><span class="mtk1">, </span><span class="mtk12">entryModule</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">generateFile</span><span class="mtk1">(</span><span class="mtk12">entryChunk</span><span class="mtk1">, </span><span class="mtk12">callback</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">build</span><span class="mtk1">(</span><span class="mtk12">modulePath</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">originCode</span><span class="mtk1"> = </span><span class="mtk12">fs</span><span class="mtk1">.</span><span class="mtk11">readFileSync</span><span class="mtk1">(</span><span class="mtk12">modulePath</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">originCode</span><span class="mtk1"> = </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">dealWidthLoader</span><span class="mtk1">(</span><span class="mtk12">modulePath</span><span class="mtk1">, </span><span class="mtk12">originCode</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">())</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">dealDependencies</span><span class="mtk1">(</span><span class="mtk12">originCode</span><span class="mtk1">, </span><span class="mtk12">modulePath</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// 将文件源码交给对应的loader</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">dealWidthLoader</span><span class="mtk1">(</span><span class="mtk12">modulePath</span><span class="mtk1">, </span><span class="mtk12">originCode</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">module</span><span class="mtk1"> &amp;&amp; </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">module</span><span class="mtk1">.</span><span class="mtk12">rules</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      ;[...</span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">module</span><span class="mtk1">.</span><span class="mtk12">rules</span><span class="mtk1">].</span><span class="mtk11">reverse</span><span class="mtk1">().</span><span class="mtk11">forEach</span><span class="mtk1">(</span><span class="mtk12">rule</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">rule</span><span class="mtk1">.</span><span class="mtk12">test</span><span class="mtk1">.</span><span class="mtk11">test</span><span class="mtk1">(</span><span class="mtk12">modulePath</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">loaders</span><span class="mtk1"> = [...</span><span class="mtk12">rule</span><span class="mtk1">.</span><span class="mtk12">use</span><span class="mtk1">].</span><span class="mtk11">reverse</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk12">loaders</span><span class="mtk1">.</span><span class="mtk11">forEach</span><span class="mtk1">(</span><span class="mtk12">loader</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> (</span><span class="mtk12">originCode</span><span class="mtk1"> = </span><span class="mtk11">loader</span><span class="mtk1">(</span><span class="mtk12">originCode</span><span class="mtk1">)))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">originCode</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// 根据ast 处理依赖</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">dealDependencies</span><span class="mtk1">(</span><span class="mtk12">code</span><span class="mtk1">, </span><span class="mtk12">modulePath</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">fullPath</span><span class="mtk1"> = </span><span class="mtk12">path</span><span class="mtk1">.</span><span class="mtk11">relative</span><span class="mtk1">(</span><span class="mtk12">process</span><span class="mtk1">.</span><span class="mtk11">cwd</span><span class="mtk1">(), </span><span class="mtk12">modulePath</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 创建模块对象</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">module</span><span class="mtk1"> = {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">id:</span><span class="mtk1"> </span><span class="mtk12">fullPath</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">dependencies:</span><span class="mtk1"> [],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 这里使用@babel/parser提供的语法树解析方法</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// https://babel.docschina.org/docs/en/babel-parser/</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">ast</span><span class="mtk1"> = </span><span class="mtk12">parser</span><span class="mtk1">.</span><span class="mtk11">parse</span><span class="mtk1">(</span><span class="mtk12">code</span><span class="mtk1">, {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">sourceType:</span><span class="mtk1"> </span><span class="mtk8">&quot;module&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 深度遍历优先 遍历语法树</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">traverser</span><span class="mtk1">.</span><span class="mtk11">default</span><span class="mtk1">(</span><span class="mtk12">ast</span><span class="mtk1">, {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// 对语法树中特定的节点进行操作 参考@babel/types （特定节点类型）</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// CallExpression 特定节点</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">CallExpression</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk12">nodePath</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">node</span><span class="mtk1"> = </span><span class="mtk12">nodePath</span><span class="mtk1">.</span><span class="mtk12">node</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">node</span><span class="mtk1">.</span><span class="mtk12">callee</span><span class="mtk1">.</span><span class="mtk12">name</span><span class="mtk1"> === </span><span class="mtk8">&quot;require&quot;</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">requirePath</span><span class="mtk1"> = </span><span class="mtk12">node</span><span class="mtk1">.</span><span class="mtk12">arguments</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">].</span><span class="mtk12">value</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">moduleDirName</span><span class="mtk1"> = </span><span class="mtk12">path</span><span class="mtk1">.</span><span class="mtk11">dirname</span><span class="mtk1">(</span><span class="mtk12">modulePath</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">fullPath</span><span class="mtk1"> = </span><span class="mtk12">path</span><span class="mtk1">.</span><span class="mtk11">relative</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">__dirname</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">path</span><span class="mtk1">.</span><span class="mtk11">join</span><span class="mtk1">(</span><span class="mtk12">moduleDirName</span><span class="mtk1">, </span><span class="mtk12">requirePath</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// t.identifier创建__webpack_require__标识符</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// 赋值给node.calllee</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// 替换掉了原来的 require</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk12">node</span><span class="mtk1">.</span><span class="mtk12">callee</span><span class="mtk1"> = </span><span class="mtk12">t</span><span class="mtk1">.</span><span class="mtk11">identifier</span><span class="mtk1">(</span><span class="mtk8">&quot;__webpack_require__&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// 将依赖的路径修改为以当前路径行为基准</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// t.stringLitera 创建了string类型</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk12">node</span><span class="mtk1">.</span><span class="mtk12">arguments</span><span class="mtk1"> = [</span><span class="mtk12">t</span><span class="mtk1">.</span><span class="mtk11">stringLiteral</span><span class="mtk1">(</span><span class="mtk12">fullPath</span><span class="mtk1">)]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// 查看这个module是否已经被处理过</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">exitModule</span><span class="mtk1"> = [...</span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">modules</span><span class="mtk1">].</span><span class="mtk11">find</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">item</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk12">item</span><span class="mtk1">.</span><span class="mtk12">id</span><span class="mtk1"> === </span><span class="mtk12">fullPath</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk15">if</span><span class="mtk1"> (!</span><span class="mtk12">exitModule</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk12">dependencies</span><span class="mtk1">.</span><span class="mtk11">push</span><span class="mtk1">(</span><span class="mtk12">fullPath</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 根据新的ast生成代码</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">_code</span><span class="mtk1"> = </span><span class="mtk12">generate</span><span class="mtk1">.</span><span class="mtk11">default</span><span class="mtk1">(</span><span class="mtk12">ast</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 保存最新的代码</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk12">_source</span><span class="mtk1"> = </span><span class="mtk12">_code</span><span class="mtk1">.</span><span class="mtk12">code</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 遍历所有依赖 并保存到modules</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk12">dependencies</span><span class="mtk1">.</span><span class="mtk11">forEach</span><span class="mtk1">(</span><span class="mtk12">dep</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">depModule</span><span class="mtk1"> = </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">build</span><span class="mtk1">(</span><span class="mtk12">dep</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">modules</span><span class="mtk1">.</span><span class="mtk11">add</span><span class="mtk1">(</span><span class="mtk12">depModule</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// 返回当前module</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk10">module</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">buildChunk</span><span class="mtk1">(</span><span class="mtk12">entryName</span><span class="mtk1">, </span><span class="mtk12">entryModule</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">name:</span><span class="mtk1"> </span><span class="mtk12">entryName</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">entryModule</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">modules:</span><span class="mtk1"> </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">modules</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">getCode</span><span class="mtk1">(</span><span class="mtk12">entryChunk</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk8">`</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">(() =&gt; {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  var __webpack_modules__ = {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    </span><span class="mtk4">${</span><span class="mtk10">Array</span><span class="mtk1">.</span><span class="mtk11">from</span><span class="mtk1">(</span><span class="mtk12">entryChunk</span><span class="mtk1">.</span><span class="mtk12">modules</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      .</span><span class="mtk11">map</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">module</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk8">`</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      &quot;</span><span class="mtk4">${</span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk10">id</span><span class="mtk4">}</span><span class="mtk8">&quot;: (module, __unused_webpack_exports, __webpack__require__) =&gt; {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">        </span><span class="mtk4">${</span><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk12">_source</span><span class="mtk4">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    `</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      .</span><span class="mtk11">join</span><span class="mtk1">(</span><span class="mtk8">&quot;,&quot;</span><span class="mtk1">)</span><span class="mtk4">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  var __webpack_module_cache__ = {};</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  function __webpack_require__(moduleId) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    var cachedModule = __webpack_module_cache__[moduleId];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    if(cachedModule !== undefined) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      return cachedModule.exports</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    var module = (__webpack_module_cache__[moduleId] = {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      exports: {}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    __webpack_modules__[moduleId](</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      module,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      module.exports,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">      __webpack_require__</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    return module.exports;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  var __webpack_exports__ = {};</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  (() =&gt; {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    </span><span class="mtk4">${</span><span class="mtk12">entryChunk</span><span class="mtk1">.</span><span class="mtk12">entryModule</span><span class="mtk1">.</span><span class="mtk12">_source</span><span class="mtk4">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">  })();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">})();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">    `</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">generateFile</span><span class="mtk1">(</span><span class="mtk12">entryChunk</span><span class="mtk1">, </span><span class="mtk12">callback</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">code</span><span class="mtk1"> = </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk11">getCode</span><span class="mtk1">(</span><span class="mtk12">entryChunk</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (!</span><span class="mtk12">fs</span><span class="mtk1">.</span><span class="mtk11">existsSync</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">output</span><span class="mtk1">.</span><span class="mtk12">path</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">fs</span><span class="mtk1">.</span><span class="mtk11">mkdirSync</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">output</span><span class="mtk1">.</span><span class="mtk12">path</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">fs</span><span class="mtk1">.</span><span class="mtk11">writeFile</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">path</span><span class="mtk1">.</span><span class="mtk11">join</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">output</span><span class="mtk1">.</span><span class="mtk12">path</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">options</span><span class="mtk1">.</span><span class="mtk12">output</span><span class="mtk1">.</span><span class="mtk12">filename</span><span class="mtk1">.</span><span class="mtk11">replace</span><span class="mtk1">(</span><span class="mtk8">&quot;[name]&quot;</span><span class="mtk1">, </span><span class="mtk12">entryChunk</span><span class="mtk1">.</span><span class="mtk12">name</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      ),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">code</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">err</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk12">callback</span><span class="mtk1"> &amp;&amp; </span><span class="mtk11">callback</span><span class="mtk1">(</span><span class="mtk12">err</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">webpack</span><span class="mtk1">(</span><span class="mtk12">options</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">compiler</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">Compiler</span><span class="mtk1">(</span><span class="mtk12">options</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">compiler</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">module</span><span class="mtk1">.</span><span class="mtk10">exports</span><span class="mtk1"> = </span><span class="mtk12">webpack</span></span></span></code></pre>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .dark-default-dark {
    background-color: #1E1E1E;
    color: #D4D4D4;
  }
  .dark-default-dark .mtk3 { color: #6A9955; }
  .dark-default-dark .mtk11 { color: #DCDCAA; }
  .dark-default-dark .mtk1 { color: #D4D4D4; }
  .dark-default-dark .mtk8 { color: #CE9178; }
  .dark-default-dark .mtk10 { color: #4EC9B0; }
  .dark-default-dark .mtk4 { color: #569CD6; }
  .dark-default-dark .mtk12 { color: #9CDCFE; }
  .dark-default-dark .mtk15 { color: #C586C0; }
  .dark-default-dark .mtk7 { color: #B5CEA8; }
  .dark-default-dark .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div><div><div class=""><div class="ant-anchor-wrapper" style="max-height:100vh;position:fixed;left:0;top:100px;width:150px"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div></div></div></div></div></main><footer style="margin-top:var(--space-5);font-size:var(--font-sm)">© <!-- -->2022<!-- --> · Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/mini-webpack/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-300d0d00742d71594f3d.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-db45316f3b099951c699.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-f7009eceb47023cfcb55.js\"],\"component---src-templates-blog-jsx\":[\"/component---src-templates-blog-jsx-73f0834f49a569ffabce.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="dec5a21b5f2ecbe64393";</script><script src="/awe/webpack-runtime-295ada613cd19851be45.js" async></script><script src="/awe/framework-a4e155cd0476dc1ca208.js" async></script><script src="/awe/app-300d0d00742d71594f3d.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>